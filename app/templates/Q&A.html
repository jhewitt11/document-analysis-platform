{% extends "base.html" %}

{% block main %}

<h2>Question & Answer</h2>
<p>Ask questions about the documents in the database.</p>
<hr>

<div class='scroller' style = 'height : 400px'>
    <div id="chat-container"></div>
</div>
<div style = "justify-content: center;">
    <input style = "width : 500px;" type="text" id="user-input" placeholder="Type your message..." />
    <button onclick="sendMessage()">Send</button>
</div>

<script>
    const chatContainer = document.getElementById('chat-container');
    const userInput = document.getElementById('user-input');

    function sendMessage() {
        const message = userInput.value;
        displayMessage('user', '\n\n\nUser : ' + message);
        userInput.value = '';

        // Make an API call to your Flask app and get the response
        // Replace this with your actual API call
        fetch('http://localhost:5000/chatResponse', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ message: message })
        })
        .then(response => response.json())
        .then(data => {
            const resp_bundle = data;

            displayMessage('app', '\nBot : ' + resp_bundle.gpt_response);
            displayMessage('app', '\nCost : ' + resp_bundle.cost_cents + ' cents')
            displayMessage('app', 'Relatedness : ' + resp_bundle.similarity);
            displayMessage('app', 'Context : ...' + resp_bundle.context + '\n');
        });

        function displayMessage(sender, message) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message');

            if (sender === 'user') {
                messageElement.classList.add('user-message');
            } else if (sender === 'app') {
                messageElement.classList.add('app-message');
            }

            messageElement.innerText = message;
            chatContainer.appendChild(messageElement);

            // Scroll to the bottom of the chat container
            chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    }

</script>
</body>
</html>

{% endblock %}